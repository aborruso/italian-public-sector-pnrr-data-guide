---
title: "OpenCUP - Focus PNRR"
---

L'ultima versione dei dati OpenCUP con focus sul PNRR è quella di [novembre 2022](https://opencup.gov.it/portale/documents/21195/0/File+CUP+opencup+pnrr_PNRR+novembre+2022new.zip).

Molto importante la nota relativa che si legge sul sito:

> Si sottolinea che i dati oggetto del rilascio open data, rappresentano gli **interventi candidati** nell’ambito del PNRR, **così come segnalati dai soggetti titolari dei singoli interventi in fase di generazione CUP**, ma che **potrebbero non essere ammessi ai finanziamenti del Piano** e successivamente finanziati da altre misure di spesa. **Per la lista definitiva dei progetti PNRR**, **si rimanda agli elenchi ufficiali emanati dalle Amministrazioni responsabili dei finanziamenti**.

::: {.callout-caution}
## Fai attenzione
Per la ragione sopra indicata, non è detto che un progetto in questo elenco sia stato finanziato dal PNRR. È però un punto di partenza per fare approfondimenti sul sito della Pubblica Amministrazione correlata al progetto.
:::

È un file compresso zip, contenente due file in formato Excel:

- uno con l’elenco dei progetti
- l'altro con i dettagli del target.

## File con l'elenco dei progetti


```{python}
#| echo: false
#| warning: false

from IPython.display import display, Markdown

!if [ ! -f tmp_summary.csv ]; then\
  <../../data/openncup/opencup-focus-pnrr.csv mlrgo --csv summary >tmp_summary.csv;\
fi

colonne=!<tmp_summary.csv mlr --c2n cut -f field_name | wc -l
righe=!<tmp_summary.csv mlr --c2n cut -f count then head -n 1

numero_cup=!<tmp_summary.csv mlr --c2n filter '$field_name=="CODICE_CUP"' then put 'if($null_count>0){$distinct_count=$distinct_count-1}else{$distinct_count=$distinct_count}' then cut -f distinct_count
numero_regioni=!<tmp_summary.csv mlr --c2n filter '$field_name=="CODI_CODICE_REGIONE"' then put 'if($null_count>0){$distinct_count=$distinct_count-1}else{$distinct_count=$distinct_count}' then cut -f distinct_count
numero_province=!<tmp_summary.csv mlr --c2n filter '$field_name=="CODI_CODICE_PROVINCIA"' then put 'if($null_count>0){$distinct_count=$distinct_count-1}else{$distinct_count=$distinct_count}' then cut -f distinct_count
numero_comuni=!<tmp_summary.csv mlr --c2n filter '$field_name=="CODI_CODICE_COMUNE"' then put 'if($null_count>0){$distinct_count=$distinct_count-1}else{$distinct_count=$distinct_count}' then cut -f distinct_count

!if [ ! -f tmp_costi.csv ]; then\
  <../../data/openncup/opencup-focus-pnrr.csv mlrgo --csv cut -f CODICE_CUP,IMPO_COSTO_PROGETTO,IMPO_IMPORTO_FINANZIATO \
    then uniq -a then stats1 -a min,max,mode,p75,mean,sum -f IMPO_COSTO_PROGETTO,IMPO_IMPORTO_FINANZIATO  >tmp_costi.csv;\
fi

#IMPO_COSTO_PROGETTO=
#IMPO_IMPORTO_FINANZIATO

text=f"""

Il file si chiama `progetto_cup_pnrr(1).xlsx`, ed è composto da **{int(righe[0])} righe** e **{int(colonne[0])} colonne**.

È ricco di informazioni. Tra queste:

- il numero di codici CUP è pari a **{int(numero_cup[0])}**;
- sono progetti riferibili a **{int(numero_regioni[0])} regioni**, **{int(numero_province[0])} province** e **{int(numero_comuni[0])} comuni**.
- ...

::: aside
Il numero di Province e Comuni è maggiore del loro numero totale in Italia, perché probabilmente si fa riferimento a Comuni e Province che sono stati soppressi.
:::

"""

display(Markdown(text))
```


Ha qualche bruttura come:

- il nome del file;
- contiene dei caratteri non correttamente codificati, e quindi non leggibili come ad esempio `dell¿abitare`;
- in due righe della colonna `DATA_GENERAZIONE_COMPLETO`, la data non è nello stesso formato delle altre - `AAAA-MM-GG` (ad esempio "2020-11-27") - ma contiene anche l'orario (ad esempio `2006-08-02 19:29:14`);
- ...
